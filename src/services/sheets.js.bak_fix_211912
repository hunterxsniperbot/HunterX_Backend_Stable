
// --- Canonical cached reader (TTL 7000 ms) ---
export async function readRowsCached(tab){
  if (!globalThis.__sheetsCache) globalThis.__sheetsCache = new Map(); // proceso-local
  const cache = globalThis.__sheetsCache; // tab -> { t, rows }
  const TTL = 7000;
  const hit = cache.get(tab);
  if (hit && (Date.now() - hit.t) < TTL) return hit.rows;
  const rows = await readRows(tab); // ⚠️ llama a readRows, NO a sí misma
  cache.set(tab, { t: Date.now(), rows });
  return rows;
}
