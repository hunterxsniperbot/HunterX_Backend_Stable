// === HunterX — announceAutoBuy (COMPRA) ===
// Formato EXACTO pedido (HTML), con botones PnL y 25/50/75/100.
function announceAutoBuy(bot, uid, info) {
  try {
    const chatId   = (bot._notifyChatByUid && bot._notifyChatByUid[uid]) ? bot._notifyChatByUid[uid] : Number(uid);
    const t        = info.trade || {};
    const tradeId  = String(t.id || t.tradeId || ("demo-" + Date.now()));
    const sym      = String(info.symbol || t.token || "—").trim();
    const mint     = String(t.mint || "So11111111111111111111111111111111111111112");
    const mintShort= mint.slice(0,6) + "…";

    const sizeUsd  = Number(info.size ?? t.amountUsd ?? 0);
    const sizeSol  = (t.sizeSol!=null) ? Number(t.sizeSol) : 0;
    const entryUsd = (t.priceUsd!=null) ? Number(t.priceUsd) : 200.0000; // placeholder ok
    const route    = t.route || "Raydium";
    const slipBps  = (t.slippageBps!=null) ? Number(t.slippageBps) : 50;
    const feesUsd  = (t.feesUsd!=null) ? Number(t.feesUsd) : 0.01;

    const buyScore  = (t.buyScorePct!=null)  ? (Number(t.buyScorePct).toFixed(0)+"%") : "—";
    const scamScore = (t.scamScorePct!=null) ? (Number(t.scamScorePct).toFixed(0)+"%") : "—";
    const T1        = (t.T1!=null) ? String(t.T1) : "—";
    const scamT1    = (t.scam_t1!=null) ? String(t.scam_t1) : "—";

    const ts = new Date().toLocaleString();

    // === Texto EXACTO (HTML) ===
    const html = [
      "✅ <b>COMPRA AUTOMÁTICA EJECUTADA </b>",
      "🧾 <b>Trade ID:</b> #"+tradeId,
      "🪙 <b>Token:</b> $"+sym+" ("+mintShort+")",
      "🔗 <b>Ruta:</b> "+route+" • <b>Slippage:</b> "+slipBps+" bps • <b>Fees/Gas:</b> ~"+feesUsd,
      "💵 <b>Invertido:</b> "+sizeUsd.toFixed(2)+" USD ("+sizeSol.toFixed(6)+" SOL) 🎯 <b>Entrada:</b> "+entryUsd.toFixed(4)+" USD",
      "📊 <b>buy_score:</b> "+buyScore+" (T1 "+T1+") • <b>scam_score:</b> "+scamScore+" (scam_t1 "+scamT1+")",
      "🛡️<b>Guardas:</b>",
      "- Honeypot ✅",
      "• LiqLocked 🔒",
      "• Renounced 🗝️",
      "• Stale ✅",
      "📈 <b>TP/SL:</b> TP — • SL — • <b>Cooldown:</b> — s",
      "⏱️ <b>Hora:</b> "+ts,
      "<b>Enlaces rápidos</b> <a href=\"https://dexscreener.com/solana\">DexScreener</a> | <a href=\"https://jup.ag/swap/SOL-USDC\">Jupiter</a> | <a href=\"https://raydium.io/swap/?from=SOL&to=USDC\">Raydium</a> | <a href=\"https://birdeye.so/token/SOL?chain=solana\">Birdeye</a> | <a href=\"https://solscan.io/token/"+mint+"\">Solscan</a> Con los botones de pnl para actualizarlos cuando quiera y bonores de venta parcial 25 50 75 100"
    ].join("\n");

    const kb = {
      inline_keyboard: [
        [{ text: "📊 PnL", callback_data: "HX_PNL:"+tradeId }],
        [
          { text: "🔁 25%", callback_data: "HX_SELL:"+tradeId+":25" },
          { text: "🔁 50%", callback_data: "HX_SELL:"+tradeId+":50" },
          { text: "🔁 75%", callback_data: "HX_SELL:"+tradeId+":75" },
          { text: "💯 100%", callback_data: "HX_SELL:"+tradeId+":100" }
        ]
      ]
    };

    bot.sendMessage(chatId, html, { parse_mode: "HTML", disable_web_page_preview: true, reply_markup: kb }).catch(()=>{});
  } catch(_) {}
}
